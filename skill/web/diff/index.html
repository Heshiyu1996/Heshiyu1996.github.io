<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Diff、React Diff、Vue Diff | Heshiyu&#39;s Blog</title>
    <meta name="description" content=" ">
    <meta name="generator" content="VuePress 1.3.1">
    <link rel="icon" href="/favicon.png">
  <link rel="manifest" href="/favicon.png">
  <link rel="apple-touch-icon" href="/favicon.png">
  <link rel="mask-icon" href="/favicon.png" color="#3eaf7c">
  <meta http-quiv="pragma" cotent="no-cache">
  <meta http-quiv="expires" cotent="0">
  <meta http-quiv="pragma" cotent="no-cache, must-revalidate">
    
    <link rel="preload" href="/assets/css/0.styles.7633c2a9.css" as="style"><link rel="preload" href="/assets/js/app.65a89ca6.js" as="script"><link rel="preload" href="/assets/js/2.f29da71a.js" as="script"><link rel="preload" href="/assets/js/3.db4d2d0b.js" as="script"><link rel="prefetch" href="/assets/js/10.ebc89002.js"><link rel="prefetch" href="/assets/js/100.b4d2cdbc.js"><link rel="prefetch" href="/assets/js/101.2a441379.js"><link rel="prefetch" href="/assets/js/102.5ac60b9a.js"><link rel="prefetch" href="/assets/js/103.d772d6de.js"><link rel="prefetch" href="/assets/js/104.b92f7f37.js"><link rel="prefetch" href="/assets/js/105.9180eeac.js"><link rel="prefetch" href="/assets/js/106.48ed1bd6.js"><link rel="prefetch" href="/assets/js/107.4bd0524f.js"><link rel="prefetch" href="/assets/js/108.bf1365c7.js"><link rel="prefetch" href="/assets/js/109.b02701bf.js"><link rel="prefetch" href="/assets/js/11.c13c4caa.js"><link rel="prefetch" href="/assets/js/110.4ef10069.js"><link rel="prefetch" href="/assets/js/111.b2a819eb.js"><link rel="prefetch" href="/assets/js/112.6f657cdd.js"><link rel="prefetch" href="/assets/js/113.097402d8.js"><link rel="prefetch" href="/assets/js/114.a7773533.js"><link rel="prefetch" href="/assets/js/115.31961814.js"><link rel="prefetch" href="/assets/js/116.3671260a.js"><link rel="prefetch" href="/assets/js/117.e5152a44.js"><link rel="prefetch" href="/assets/js/118.6d22e43a.js"><link rel="prefetch" href="/assets/js/119.7b87075e.js"><link rel="prefetch" href="/assets/js/12.1445d451.js"><link rel="prefetch" href="/assets/js/120.7657b280.js"><link rel="prefetch" href="/assets/js/121.62cd7313.js"><link rel="prefetch" href="/assets/js/122.69527952.js"><link rel="prefetch" href="/assets/js/123.012c549f.js"><link rel="prefetch" href="/assets/js/124.bc043df7.js"><link rel="prefetch" href="/assets/js/125.0aeb0830.js"><link rel="prefetch" href="/assets/js/126.ed4b07ba.js"><link rel="prefetch" href="/assets/js/127.77e47004.js"><link rel="prefetch" href="/assets/js/128.b997f4f6.js"><link rel="prefetch" href="/assets/js/129.db52353b.js"><link rel="prefetch" href="/assets/js/13.430a6558.js"><link rel="prefetch" href="/assets/js/130.7ad688f0.js"><link rel="prefetch" href="/assets/js/131.73ce6693.js"><link rel="prefetch" href="/assets/js/132.f913fab6.js"><link rel="prefetch" href="/assets/js/133.6e124659.js"><link rel="prefetch" href="/assets/js/134.5d39fce0.js"><link rel="prefetch" href="/assets/js/135.df76cef1.js"><link rel="prefetch" href="/assets/js/136.49c17fd8.js"><link rel="prefetch" href="/assets/js/137.c963605a.js"><link rel="prefetch" href="/assets/js/138.0960be37.js"><link rel="prefetch" href="/assets/js/139.7561af94.js"><link rel="prefetch" href="/assets/js/14.c4c23519.js"><link rel="prefetch" href="/assets/js/140.5b1e0955.js"><link rel="prefetch" href="/assets/js/141.6e812e39.js"><link rel="prefetch" href="/assets/js/142.70c1f944.js"><link rel="prefetch" href="/assets/js/143.30526f1b.js"><link rel="prefetch" href="/assets/js/144.de4cb928.js"><link rel="prefetch" href="/assets/js/145.8314da63.js"><link rel="prefetch" href="/assets/js/146.7e34fe61.js"><link rel="prefetch" href="/assets/js/147.d347a372.js"><link rel="prefetch" href="/assets/js/148.91b524de.js"><link rel="prefetch" href="/assets/js/149.7377742f.js"><link rel="prefetch" href="/assets/js/15.a14f00ac.js"><link rel="prefetch" href="/assets/js/150.a9afd2ce.js"><link rel="prefetch" href="/assets/js/151.61adf142.js"><link rel="prefetch" href="/assets/js/152.a15f492b.js"><link rel="prefetch" href="/assets/js/153.d2cee6f9.js"><link rel="prefetch" href="/assets/js/154.873f2d81.js"><link rel="prefetch" href="/assets/js/155.6f4a84c4.js"><link rel="prefetch" href="/assets/js/156.61ba33b3.js"><link rel="prefetch" href="/assets/js/157.2c8c648a.js"><link rel="prefetch" href="/assets/js/158.d5836763.js"><link rel="prefetch" href="/assets/js/159.54178633.js"><link rel="prefetch" href="/assets/js/16.478cb84e.js"><link rel="prefetch" href="/assets/js/17.0ec5677a.js"><link rel="prefetch" href="/assets/js/18.14d58603.js"><link rel="prefetch" href="/assets/js/19.0b1366e3.js"><link rel="prefetch" href="/assets/js/20.117d1412.js"><link rel="prefetch" href="/assets/js/21.abe24aa9.js"><link rel="prefetch" href="/assets/js/22.722cd643.js"><link rel="prefetch" href="/assets/js/23.4f37818d.js"><link rel="prefetch" href="/assets/js/24.c5bea59b.js"><link rel="prefetch" href="/assets/js/25.2ea169c1.js"><link rel="prefetch" href="/assets/js/26.b98a4fd4.js"><link rel="prefetch" href="/assets/js/27.05de9df1.js"><link rel="prefetch" href="/assets/js/28.90fb3911.js"><link rel="prefetch" href="/assets/js/29.8c68c2f2.js"><link rel="prefetch" href="/assets/js/30.37011b6a.js"><link rel="prefetch" href="/assets/js/31.50fb896d.js"><link rel="prefetch" href="/assets/js/32.988ac9ff.js"><link rel="prefetch" href="/assets/js/33.78e07c85.js"><link rel="prefetch" href="/assets/js/34.5f855160.js"><link rel="prefetch" href="/assets/js/35.096238b1.js"><link rel="prefetch" href="/assets/js/36.fd76455c.js"><link rel="prefetch" href="/assets/js/37.ce7766e3.js"><link rel="prefetch" href="/assets/js/38.c1a5a827.js"><link rel="prefetch" href="/assets/js/39.27b1ef4f.js"><link rel="prefetch" href="/assets/js/4.9d001fc4.js"><link rel="prefetch" href="/assets/js/40.37854300.js"><link rel="prefetch" href="/assets/js/41.76754f35.js"><link rel="prefetch" href="/assets/js/42.0e01d4f6.js"><link rel="prefetch" href="/assets/js/43.ed84031e.js"><link rel="prefetch" href="/assets/js/44.71c89784.js"><link rel="prefetch" href="/assets/js/45.09966fb0.js"><link rel="prefetch" href="/assets/js/46.ef42514c.js"><link rel="prefetch" href="/assets/js/47.ebd96f8e.js"><link rel="prefetch" href="/assets/js/48.f05a4d1c.js"><link rel="prefetch" href="/assets/js/49.ba9c225f.js"><link rel="prefetch" href="/assets/js/5.7ae6c8a4.js"><link rel="prefetch" href="/assets/js/50.78837426.js"><link rel="prefetch" href="/assets/js/51.8d868e0c.js"><link rel="prefetch" href="/assets/js/52.d17af8b3.js"><link rel="prefetch" href="/assets/js/53.7c8cb809.js"><link rel="prefetch" href="/assets/js/54.70181b6d.js"><link rel="prefetch" href="/assets/js/55.9015f413.js"><link rel="prefetch" href="/assets/js/56.b061d11e.js"><link rel="prefetch" href="/assets/js/57.83fe971c.js"><link rel="prefetch" href="/assets/js/58.39a9b9a1.js"><link rel="prefetch" href="/assets/js/59.c96d7058.js"><link rel="prefetch" href="/assets/js/6.17e2a2cf.js"><link rel="prefetch" href="/assets/js/60.544cf086.js"><link rel="prefetch" href="/assets/js/61.b2ec0106.js"><link rel="prefetch" href="/assets/js/62.e2b8d1e4.js"><link rel="prefetch" href="/assets/js/63.6157df7b.js"><link rel="prefetch" href="/assets/js/64.ccda49ed.js"><link rel="prefetch" href="/assets/js/65.da8f39df.js"><link rel="prefetch" href="/assets/js/66.40cc94e6.js"><link rel="prefetch" href="/assets/js/67.7f1424f4.js"><link rel="prefetch" href="/assets/js/68.2ed9ae6a.js"><link rel="prefetch" href="/assets/js/69.bf6264e5.js"><link rel="prefetch" href="/assets/js/7.d9a21c27.js"><link rel="prefetch" href="/assets/js/70.fe73bea0.js"><link rel="prefetch" href="/assets/js/71.6734edf7.js"><link rel="prefetch" href="/assets/js/72.212ef0e9.js"><link rel="prefetch" href="/assets/js/73.f24a7182.js"><link rel="prefetch" href="/assets/js/74.325f0109.js"><link rel="prefetch" href="/assets/js/75.15619ba3.js"><link rel="prefetch" href="/assets/js/76.f42c5bf2.js"><link rel="prefetch" href="/assets/js/77.4bc28314.js"><link rel="prefetch" href="/assets/js/78.74d629b1.js"><link rel="prefetch" href="/assets/js/79.56d81e69.js"><link rel="prefetch" href="/assets/js/8.d8294feb.js"><link rel="prefetch" href="/assets/js/80.fafbf927.js"><link rel="prefetch" href="/assets/js/81.20757e97.js"><link rel="prefetch" href="/assets/js/82.e7aec67a.js"><link rel="prefetch" href="/assets/js/83.4199ce20.js"><link rel="prefetch" href="/assets/js/84.233ee461.js"><link rel="prefetch" href="/assets/js/85.94e19582.js"><link rel="prefetch" href="/assets/js/86.99ee15a8.js"><link rel="prefetch" href="/assets/js/87.0a112635.js"><link rel="prefetch" href="/assets/js/88.05c57f8d.js"><link rel="prefetch" href="/assets/js/89.94013c48.js"><link rel="prefetch" href="/assets/js/9.11a15702.js"><link rel="prefetch" href="/assets/js/90.331bb884.js"><link rel="prefetch" href="/assets/js/91.54712a27.js"><link rel="prefetch" href="/assets/js/92.8691c112.js"><link rel="prefetch" href="/assets/js/93.724e7fc2.js"><link rel="prefetch" href="/assets/js/94.bd37ab36.js"><link rel="prefetch" href="/assets/js/95.bfa036f5.js"><link rel="prefetch" href="/assets/js/96.4ff4071b.js"><link rel="prefetch" href="/assets/js/97.ce72eea3.js"><link rel="prefetch" href="/assets/js/98.d14b037b.js"><link rel="prefetch" href="/assets/js/99.68b4e5e1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.7633c2a9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Heshiyu's Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/overview/" class="nav-link">
  总览
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端积累" class="dropdown-title"><span class="title">前端积累</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/skill/html/" class="nav-link">
  HTML
</a></li><li class="dropdown-subitem"><a href="/skill/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-subitem"><a href="/skill/js/" class="nav-link">
  JS
</a></li><li class="dropdown-subitem"><a href="/skill/web/" class="nav-link router-link-active">
  Web/浏览器
</a></li></ul></li><li class="dropdown-item"><h4>
          框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/skill/react/" class="nav-link">
  React
</a></li><li class="dropdown-subitem"><a href="/skill/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-subitem"><a href="/skill/nodejs/" class="nav-link">
  NodeJS
</a></li></ul></li><li class="dropdown-item"><h4>
          笔记
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/skill/personal/" class="nav-link">
  个人笔记
</a></li><li class="dropdown-subitem"><a href="/skill/project/" class="nav-link">
  项目笔记
</a></li><li class="dropdown-subitem"><a href="/skill/note/" class="nav-link">
  读书/参会心得
</a></li></ul></li><li class="dropdown-item"><h4>
          前端周边
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/skill/computeracy/" class="nav-link">
  计算机
</a></li><li class="dropdown-subitem"><a href="/skill/algorithm/" class="nav-link">
  算法
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工程产出" class="dropdown-title"><span class="title">工程产出</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          前端规范
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/output/standard/css/" class="nav-link">
  CSS规范
</a></li><li class="dropdown-subitem"><a href="/output/standard/js/" class="nav-link">
  JS规范
</a></li><li class="dropdown-subitem"><a href="/output/standard/eslint/" class="nav-link">
  ESLint &amp; Prettier规范
</a></li><li class="dropdown-subitem"><a href="/output/standard/stylelint/" class="nav-link">
  Stylelint规范
</a></li><li class="dropdown-subitem"><a href="/output/standard/git/" class="nav-link">
  Git规范
</a></li></ul></li><li class="dropdown-item"><h4>
          项目沉淀
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/output/fruit/template/" class="nav-link">
  React工程模板
</a></li><li class="dropdown-subitem"><a href="/output/fruit/component-lib/" class="nav-link">
  基于Antd的业务组件库
</a></li></ul></li><li class="dropdown-item"><h4>
          前端工程模板
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://github.com/netease-frontend-institute/ehr-react-template/tree/single/js" target="_blank" rel="noopener noreferrer" class="nav-link external">
  单页项目（react16.9 + webpack4）
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://github.com/netease-frontend-institute/ehr-react-template/tree/single/ts" target="_blank" rel="noopener noreferrer" class="nav-link external">
  单页项目（react16.9 + webpack4 + Typescript）
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://github.com/netease-frontend-institute/ehr-react-template/tree/multiple/js" target="_blank" rel="noopener noreferrer" class="nav-link external">
  多页项目（react16.9 + webpack4）
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div></div><div class="nav-item"><a href="/tool/" class="nav-link">
  实用工具
</a></div> <a href="https://github.com/Heshiyu1996" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/overview/" class="nav-link">
  总览
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端积累" class="dropdown-title"><span class="title">前端积累</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          基础
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/skill/html/" class="nav-link">
  HTML
</a></li><li class="dropdown-subitem"><a href="/skill/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-subitem"><a href="/skill/js/" class="nav-link">
  JS
</a></li><li class="dropdown-subitem"><a href="/skill/web/" class="nav-link router-link-active">
  Web/浏览器
</a></li></ul></li><li class="dropdown-item"><h4>
          框架
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/skill/react/" class="nav-link">
  React
</a></li><li class="dropdown-subitem"><a href="/skill/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-subitem"><a href="/skill/nodejs/" class="nav-link">
  NodeJS
</a></li></ul></li><li class="dropdown-item"><h4>
          笔记
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/skill/personal/" class="nav-link">
  个人笔记
</a></li><li class="dropdown-subitem"><a href="/skill/project/" class="nav-link">
  项目笔记
</a></li><li class="dropdown-subitem"><a href="/skill/note/" class="nav-link">
  读书/参会心得
</a></li></ul></li><li class="dropdown-item"><h4>
          前端周边
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/skill/computeracy/" class="nav-link">
  计算机
</a></li><li class="dropdown-subitem"><a href="/skill/algorithm/" class="nav-link">
  算法
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工程产出" class="dropdown-title"><span class="title">工程产出</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          前端规范
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/output/standard/css/" class="nav-link">
  CSS规范
</a></li><li class="dropdown-subitem"><a href="/output/standard/js/" class="nav-link">
  JS规范
</a></li><li class="dropdown-subitem"><a href="/output/standard/eslint/" class="nav-link">
  ESLint &amp; Prettier规范
</a></li><li class="dropdown-subitem"><a href="/output/standard/stylelint/" class="nav-link">
  Stylelint规范
</a></li><li class="dropdown-subitem"><a href="/output/standard/git/" class="nav-link">
  Git规范
</a></li></ul></li><li class="dropdown-item"><h4>
          项目沉淀
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/output/fruit/template/" class="nav-link">
  React工程模板
</a></li><li class="dropdown-subitem"><a href="/output/fruit/component-lib/" class="nav-link">
  基于Antd的业务组件库
</a></li></ul></li><li class="dropdown-item"><h4>
          前端工程模板
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://github.com/netease-frontend-institute/ehr-react-template/tree/single/js" target="_blank" rel="noopener noreferrer" class="nav-link external">
  单页项目（react16.9 + webpack4）
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://github.com/netease-frontend-institute/ehr-react-template/tree/single/ts" target="_blank" rel="noopener noreferrer" class="nav-link external">
  单页项目（react16.9 + webpack4 + Typescript）
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-subitem"><a href="https://github.com/netease-frontend-institute/ehr-react-template/tree/multiple/js" target="_blank" rel="noopener noreferrer" class="nav-link external">
  多页项目（react16.9 + webpack4）
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></li></ul></div></div><div class="nav-item"><a href="/tool/" class="nav-link">
  实用工具
</a></div> <a href="https://github.com/Heshiyu1996" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>《Web/浏览器》</span> <!----></p> <!----></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Web</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/skill/web/diff/" class="active sidebar-link">Diff、React Diff、Vue Diff</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/skill/web/diff/#传统diff算法" class="sidebar-link">传统diff算法</a></li><li class="sidebar-sub-header"><a href="/skill/web/diff/#什么是virtual-dom" class="sidebar-link">什么是Virtual DOM</a></li><li class="sidebar-sub-header"><a href="/skill/web/diff/#react-virtual-dom-diff" class="sidebar-link">[React] Virtual DOM Diff</a></li><li class="sidebar-sub-header"><a href="/skill/web/diff/#react-fiber-diff" class="sidebar-link">[React] Fiber Diff</a></li><li class="sidebar-sub-header"><a href="/skill/web/diff/#vue-virtual-dom-diff" class="sidebar-link">[Vue] Virtual DOM Diff</a></li><li class="sidebar-sub-header"><a href="/skill/web/diff/#四种diff算法总结" class="sidebar-link">四种Diff算法总结</a></li><li class="sidebar-sub-header"><a href="/skill/web/diff/#参考链接" class="sidebar-link">参考链接</a></li></ul></li><li><a href="/skill/web/cdn/" class="sidebar-link">CDN</a></li><li><a href="/skill/web/cors/" class="sidebar-link">跨域资源共享（CORS）</a></li><li><a href="/skill/web/http/" class="sidebar-link">HTTP</a></li><li><a href="/skill/web/web-vitals/" class="sidebar-link">Web Vitals</a></li><li><a href="/skill/web/optimize/" class="sidebar-link">Web性能优化</a></li><li><a href="/skill/web/ssr/" class="sidebar-link">浏览器/服务端渲染</a></li><li><a href="/skill/web/web-attack/" class="sidebar-link">XSS、CSRF、SQL注入</a></li><li><a href="/skill/web/web-storage/" class="sidebar-link">WebStorage</a></li><li><a href="/skill/web/websocket/" class="sidebar-link">WebSocket</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>浏览器</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/skill/web/browser/" class="sidebar-link">浏览器基础</a></li><li><a href="/skill/web/browser-cache/" class="sidebar-link">浏览器缓存机制</a></li><li><a href="/skill/web/other/" class="sidebar-link">其他</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="diff、react-diff、vue-diff"><a href="#diff、react-diff、vue-diff" class="header-anchor">#</a> Diff、React Diff、Vue Diff</h1> <p></p><div class="table-of-contents"><ul><li><a href="#diff、react-diff、vue-diff">Diff、React Diff、Vue Diff</a><ul><li><a href="#传统diff算法">传统diff算法</a></li><li><a href="#什么是virtual-dom">什么是Virtual DOM</a></li><li><a href="#react-virtual-dom-diff">[React] Virtual DOM Diff</a></li><li><a href="#react-fiber-diff">[React] Fiber Diff</a></li><li><a href="#vue-virtual-dom-diff">[Vue] Virtual DOM Diff</a></li><li><a href="#四种diff算法总结">四种Diff算法总结</a></li><li><a href="#参考链接">参考链接</a></li></ul></li></ul></div><p></p> <h2 id="传统diff算法"><a href="#传统diff算法" class="header-anchor">#</a> 传统diff算法</h2> <blockquote><p>算法复杂度O(n3)</p></blockquote> <p>通过<strong>递归</strong>，对 HTML DOM树里的节点 进行依次对比。</p> <h2 id="什么是virtual-dom"><a href="#什么是virtual-dom" class="header-anchor">#</a> 什么是Virtual DOM</h2> <p>渲染真实DOM的开销很大，直接渲染到真实DOM会引起整个DOM树的<strong>重排</strong>和<strong>重绘</strong>。</p> <p>React、Vue都<strong>采用Virtual DOM来实现对真实DOM的映射</strong>，所以React Diff、Vue Diff算法的实质是 <strong>对两个JavaScript对象的差异查找</strong>。</p> <p>真实DOM：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>reactID<span class="token punctuation">&quot;</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>myDiv<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>React Virtual DOM</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
  type<span class="token operator">:</span> <span class="token string">'div'</span><span class="token punctuation">,</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span>
      id<span class="token operator">:</span> <span class="token string">'reactID'</span><span class="token punctuation">,</span>
      className<span class="token operator">:</span> <span class="token string">'myDiv'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  chidren<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>type<span class="token operator">:</span> <span class="token string">'p'</span><span class="token punctuation">,</span>props<span class="token operator">:</span><span class="token punctuation">{</span>value<span class="token operator">:</span><span class="token string">'1'</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li>Vue Virtual DOM</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// body下的 &lt;div id=&quot;vueId&quot; class=&quot;classA&quot;&gt;&lt;div&gt; 对应的 oldVnode 就是</span>
<span class="token punctuation">{</span>
  el<span class="token operator">:</span>  div  <span class="token comment">//对真实的节点的引用，本例中就是document.querySelector('#vueId.classA')</span>
  tagName<span class="token operator">:</span> <span class="token string">'DIV'</span><span class="token punctuation">,</span>   <span class="token comment">//节点的标签</span>
  sel<span class="token operator">:</span> <span class="token string">'div#vueId.classA'</span>  <span class="token comment">//节点的选择器</span>
  data<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>       <span class="token comment">// 一个存储节点属性的对象，对应节点的el[prop]属性，例如onclick , style</span>
  children<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//存储子节点的数组，每个子节点也是vnode结构</span>
  text<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>    <span class="token comment">//如果是文本节点，对应文本节点的textContent，否则为null</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="react-virtual-dom-diff"><a href="#react-virtual-dom-diff" class="header-anchor">#</a> [React] Virtual DOM Diff</h2> <blockquote><p>算法复杂度为O(n)</p></blockquote> <p>React diff（v16前）基于三个策略：</p> <ul><li>忽略DOM节点的跨层级操作（因为特别少）</li> <li>拥有相同类的两个组件将会生成相似的树形结构，拥有不同类的两个组件将会生成不同的树形结构</li> <li>同一层级的一组子节点，通过<code>key</code>值进行区分</li></ul> <p>基于以上三个策略，React分别对<code>tree diff</code>、<code>component diff</code>、<code>element diff</code>进行了算法优化。</p> <blockquote><p>即：不同层级不比、不同组件类型不比、不同key值不比</p></blockquote> <h3 id="tree-diff"><a href="#tree-diff" class="header-anchor">#</a> tree diff</h3> <p><strong>比较范围：</strong> 树之间。</p> <p><strong>步骤：</strong> 对树进行分层比较，两棵树只会对同一层次的节点进行比较。如果节点不存在了则会直接销毁。不会进一步比较。</p> <blockquote><p>所以只需对树进行一次遍历，便能完成整个DOM树的比较。</p></blockquote> <p><img src="/assets/img/img-1.500eeda9.png" alt="alt"></p> <blockquote><p>React只会对相同颜色方框内的DOM节点进行比较（即同一个父节点下的所有子节点）。</p></blockquote> <p><strong>建议：</strong></p> <ul><li>应保持DOM结构的稳定（尽可能少地动态操作DOM结构）</li> <li>减少节点数</li> <li>可通过CSS隐藏/显示节点，而不是真正移除/添加DOM节点</li></ul> <h4 id="对于跨层级的节点，只有-创建-和-删除-操作"><a href="#对于跨层级的节点，只有-创建-和-删除-操作" class="header-anchor">#</a> 对于跨层级的节点，只有 创建 和 删除 操作</h4> <p><img src="/assets/img/img-2.ee0d472c.png" alt="alt"></p> <blockquote><p>React diff 的执行情况： delete A -&gt; create A -&gt; create B -&gt; create C。</p></blockquote> <h3 id="component-diff"><a href="#component-diff" class="header-anchor">#</a> component diff</h3> <p><strong>比较范围：</strong> 组件之间。</p> <p><strong>步骤：</strong></p> <ul><li>同一类型的组件（即：两节点是同一个组件类的两个不同实例），按照 <code>同层比较策略</code> 继续比较Virtual DOM tree（也可以指定<code>shouldComponentUpdate</code>无需比较）</li> <li>如果不是，则将该组件判断为<code>dirty component</code>，从而替换整个组件（因为React认为：不同类型的组件，DOM树相同的情况非常少）</li></ul> <p><img src="/assets/img/img-3.653037c4.png" alt="alt"></p> <blockquote><p>当component D改变为component G时，即使这两个component结构相似。但React会认为<strong>D和G是不同类型的组件</strong>，就不会比较二者的结构：直接删除component D，重新创建component G以及其子节点。</p></blockquote> <p><strong>建议：</strong></p> <ul><li>对于同一类型的组件，可以通过<code>shouldComponentUpdate()</code>来判断该组件是否需要diff</li> <li>对于类似的结构应尽量封装成组件，既减少代码量，又能减少component diff的性能损耗。</li></ul> <h3 id="element-diff"><a href="#element-diff" class="header-anchor">#</a> element diff</h3> <p><strong>比较范围：</strong> 同一层级的节点之间。</p> <p>React diff提供了三种“同层级节点”的操作：<code>插入</code>、<code>删除</code>、<code>移动</code>。</p> <p><strong>步骤：</strong></p> <ul><li>对新集合中的节点进行循环遍历<code>for (name in nextChildren)</code></li> <li>先判断 <strong>新旧集合中是否存在相同的节点</strong>（通过唯一的<code>key</code>值）<code>if(prevChild === nextChild)</code>，如果不存在，则进行 <code>插入</code>；</li> <li>如果旧集合中存在，则比较 <code>当前节点在旧集合中的位置（child._mountIndex）</code> 与 <code>访问过的节点，在旧集合中最右的位置（lastInddex）</code></li> <li><code>if(child._mountIndex &gt; lastIndex)</code>，说明<strong>当前访问节点在旧集合中的位置 就比 上一个节点位置 靠后，则该节点不会影响其他节点的位置，不需执行移动操作</strong>；否则进行移动</li></ul> <p><img src="/assets/img/img-4.2a5ca4ea.png" alt="alt"></p> <blockquote><p>React diff 的执行情况：B、D不作任何操作，A、C进行移动即可。</p></blockquote> <p><strong>建议：</strong></p> <ul><li>给同一层级的同组子节点设置<code>key</code>值</li> <li>尽量减少类似将最后一个节点移动到列表首部的操作</li></ul> <p><strong>注意：</strong> 这种方式和Vue不太一样。Vue采用的是由<strong>两端至中间</strong>，先是4种比较方式，都匹配不上，就是key比较。</p> <h3 id="react更新阶段"><a href="#react更新阶段" class="header-anchor">#</a> React更新阶段</h3> <p>实际上，只有在 <strong>React更新阶段的DOM元素更新过程</strong> 才会执行Diff算法。</p> <p>React更新阶段会对ReactElement类型（Text节点、组件、DOM）判断，从而进行不同的操作。</p> <ul><li>Text节点：直接更新文案</li> <li>组件：结合策略二</li> <li>DOM：<strong>调用diff算法</strong>（<code>this._updateDOMChildren</code>）</li></ul> <p><img src="/assets/img/img-5.b53b39e8.png" alt="alt"></p> <h3 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h3> <p><img src="/assets/img/img-6.e7a97a31.png" alt="alt">)</p> <h2 id="react-fiber-diff"><a href="#react-fiber-diff" class="header-anchor">#</a> [React] Fiber Diff</h2> <p>React16改造了Virtal DOM的结构，引入了<code>Fiber</code>的链表结构。</p> <blockquote><p>因为以前的Virtual DOM Diff可能比较耗时，导致浏览器FPS降低。</p></blockquote> <h3 id="react-fiber"><a href="#react-fiber" class="header-anchor">#</a> React Fiber</h3> <p><code>Fiber节点</code>就相当于以前的 Virtual DOM节点 ，结构如下：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> Fiber <span class="token operator">=</span> <span class="token punctuation">{</span>
  tag<span class="token operator">:</span> <span class="token constant">HOST_COMPONENT</span><span class="token punctuation">,</span>
  type<span class="token operator">:</span> <span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span>
  <span class="token keyword">return</span><span class="token operator">:</span> parentFiber<span class="token punctuation">,</span> <span class="token comment">// 当前节点的父节点</span>
  child<span class="token operator">:</span> childFiber<span class="token punctuation">,</span> <span class="token comment">// 第一个子节点</span>
  sibling<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 右边的第一个兄弟节点</span>
  alternate<span class="token operator">:</span> currentFiber<span class="token punctuation">,</span> <span class="token comment">// 当前节点对应的新Fiber节点（带有新的props和state）</span>
  stateNode<span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">)</span><span class="token operator">|</span> instance<span class="token punctuation">,</span>
  props<span class="token operator">:</span> <span class="token punctuation">{</span> children<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> className<span class="token operator">:</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  partialState<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  effectTag<span class="token operator">:</span> <span class="token constant">PLACEMENT</span><span class="token punctuation">,</span>
  effects<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>假设有这么一个DOM结构：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>通过 <strong>链表的形式</strong> 去描述整棵树：</p> <p><img src="/assets/img/img-10.a5b62bc7.png" alt="alt"></p> <p><strong>Fiber数据结构选用链表</strong>的好处：在遍历Diff时，即使中断了，但只需记住中断时的那个节点，就可在下一个时间片空闲时，继续Diff。</p> <h3 id="fiber-diff的大致过程"><a href="#fiber-diff的大致过程" class="header-anchor">#</a> Fiber Diff的大致过程</h3> <p><strong>从链表头开始遍历，碰到一个节点就和它自己的 <code>alternate</code> 比较，并记录下需要更新的东西（作为<code>commit</code>），并把这些更新通过 <code>return</code> 提交到当前节点的父节点。当遍历完整个链表时，再通过 <code>return</code> 回溯到根节点。这样就能把所有的更新全部带到根节点，最后更新到真实的DOM中。</strong></p> <blockquote><p>Fiber Diff算法是基于 <strong>节点的“插入、删除、移动”等操作都是在同一层级中进行</strong> 这个前提的。</p></blockquote> <p><img src="/assets/img/img-12.87ce9ca7.png" alt="alt"></p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>从根节点开始：</p> <ul><li>div1通过 child 到div2</li> <li>div2 和自己的 alternate 比较完，把更新 commit1 通过return 提交到 div1</li> <li>div2 通过 sibling 到ul 1</li> <li>ul1 和自己的 alternate 比较完，把更新 commit2 通过return 提交到 div1</li> <li>ul1 通过 child 到 li1</li> <li>li1 和自己的 alternate 比较完，把更新 commit3 通过return 提交到 ul1</li> <li>li1 通过 sibling 到 li2</li> <li>li2 和自己的 alternate 比较完，把更新 commit4 通过return 提交到 ul1</li> <li><strong>遍历完成，开始回溯。li2 通过 return 回到 ul1</strong>（注意是到 li2 才 return）</li> <li>ul1 把 commit3 和 commit4 通过 return 提交到 div</li> <li>ul1 通过 return 到 div1</li> <li>div1 获取到所有更新 commit1、commit2、commit3、commit4，一次性更新到真实的DOM中</li></ul></div> <h3 id="fiber-diff的入口函数"><a href="#fiber-diff的入口函数" class="header-anchor">#</a> Fiber Diff的入口函数</h3> <p>Fiber Diff是从 <code>reconcileChildren</code> 开始的 <em>（非首次渲染时）</em></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">reconcileChildren</span><span class="token punctuation">(</span>
  <span class="token parameter">current<span class="token operator">:</span> Fiber <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  workInProgress<span class="token operator">:</span> Fiber<span class="token punctuation">,</span>
  nextChildren<span class="token operator">:</span> any<span class="token punctuation">,</span>
  renderExpirationTime<span class="token operator">:</span> ExpirationTime<span class="token punctuation">,</span></span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 如果首次渲染，通过mountChildFibers创建子节点的Fiber实例</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>current <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    workInProgress<span class="token punctuation">.</span>child <span class="token operator">=</span> <span class="token function">mountChildFibers</span><span class="token punctuation">(</span>
      workInProgress<span class="token punctuation">,</span>
      <span class="token keyword">null</span><span class="token punctuation">,</span>
      nextChildren<span class="token punctuation">,</span>
      renderExpirationTime<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// 否则，通过reconcileChildFibers进行Diff</span>
    workInProgress<span class="token punctuation">.</span>child <span class="token operator">=</span> <span class="token function">reconcileChildFibers</span><span class="token punctuation">(</span>
      workInProgress<span class="token punctuation">,</span>
      current<span class="token punctuation">.</span>child<span class="token punctuation">,</span>
      nextChildren<span class="token punctuation">,</span>
      renderExpirationTime<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p><code>reconcileChildFibers</code>函数的作用：<strong>构建<code>currentInWorkProgress</code>，然后得出<code>effect list</code>，为下一个阶段（commit）做准备</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">reconcileChildFibers</span><span class="token punctuation">(</span>
  returnFiber<span class="token operator">:</span> Fiber<span class="token punctuation">,</span> <span class="token comment">// 即将Diff的这层的父节点</span>
  currentFirstChild<span class="token operator">:</span> Fiber <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 当前层的第一个Fiber节点</span>
  newChild<span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token comment">// 即将更新的vdom节点（可能是个TextNode、可能是ReactElement、可能是数组），不是Fiber节点</span>
  expirationTime<span class="token operator">:</span> ExpirationTime<span class="token punctuation">,</span> <span class="token comment">// 过期时间（与diff无关）</span>
<span class="token punctuation">)</span><span class="token operator">:</span> Fiber <span class="token operator">|</span> <span class="token keyword">null</span> <span class="token punctuation">{</span>
  <span class="token comment">// 主要的 Diff 逻辑</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>对于 <code>currentFirstChild</code> 会有 <strong>4 种情况</strong>：</p> <ul><li>TextNode</li> <li>React Element（通过该节点是否有 <code>$$typeof</code> 区分）</li> <li>数组</li> <li>可迭代的children（跟数组的处理方式差不多）</li></ul> <blockquote><p>注意：currentFirstNode是当前层的第一个Fiber节点。</p></blockquote> <h3 id="textnode【待更新】"><a href="#textnode【待更新】" class="header-anchor">#</a> TextNode【待更新】</h3> <p>如果<code>currentFirstChild</code> 是 <code>TextNode</code></p> <ul><li><code>xxx</code> 也是 <code>TextNode</code>，那就代表这个节点可以复用</li> <li><code>xxx</code> 不是 <code>TextNode</code></li></ul> <p>Demo：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// before：当前 UI 对应的节点的 jsx</span>
<span class="token keyword">return</span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
  <span class="token comment">// ...</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>xxx<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>xxx<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>xxx<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>xxx<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token comment">//...</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">)</span>

<span class="token comment">// after：更新成功后的节点对应的 jsx</span>
<span class="token keyword">return</span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
  <span class="token comment">// ...</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
          前端桃园
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token comment">//...</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p><img src="/assets/img/img-10.a5b62bc7.png" alt="alt"></p> <p>若<code>currentFirstNode</code>不是TextNode，就代表这个节点不能复用。会从<code>currentFirstNode</code>开始，<strong>删除剩余的节点</strong>。</p> <h3 id="react-element【待更新】"><a href="#react-element【待更新】" class="header-anchor">#</a> React Element【待更新】</h3> <p>对于<code>React Element</code>判断这个节点是否可以复用：</p> <ul><li>key相同</li> <li>节点的类型相同</li></ul> <p>同时满足以上两点，代表这个节点只是内容变化，不需要创建新的节点，是可以复用的。</p> <p>如果节点类型不相同，就将节点从当前节点开始，把剩余的都删除。</p> <h3 id="array【待更新】"><a href="#array【待更新】" class="header-anchor">#</a> Array【待更新】</h3> <p>建议：在开发组件时，保持稳定的DOM结构有助于性能提升。</p> <h2 id="vue-virtual-dom-diff"><a href="#vue-virtual-dom-diff" class="header-anchor">#</a> [Vue] Virtual DOM Diff</h2> <p>Vue和React一样，只进行<strong>同层比较，忽略跨级操作</strong>。</p> <p>当响应式属性<code>setter</code>执行<code>Dep.notify()</code>时，就会开始执行<code>patch</code>，一边比较新、旧节点，一边给<code>真实DOM</code>打补丁。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">patch</span> <span class="token punctuation">(</span><span class="token parameter">oldVnode<span class="token punctuation">,</span> vnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldVnode<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 不同类型节点，直接用新节点替换整个老节点</span>
        <span class="token keyword">const</span> oEl <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>el
        <span class="token keyword">let</span> parentEle <span class="token operator">=</span> api<span class="token punctuation">.</span><span class="token function">parentNode</span><span class="token punctuation">(</span>oEl<span class="token punctuation">)</span>
        <span class="token function">createEle</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>parentEle <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            api<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>parentEle<span class="token punctuation">,</span> vnode<span class="token punctuation">.</span>el<span class="token punctuation">,</span> api<span class="token punctuation">.</span><span class="token function">nextSibling</span><span class="token punctuation">(</span>oEl<span class="token punctuation">)</span><span class="token punctuation">)</span>
            api<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>parentEle<span class="token punctuation">,</span> oldVnode<span class="token punctuation">.</span>el<span class="token punctuation">)</span>
            oldVnode <span class="token operator">=</span> <span class="token keyword">null</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> vnode
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><code>sameVnode</code>会当两节点的<code>key</code> &amp;&amp; <code>sel</code>相同时，认为是同一类型节点。此时不需要移动。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">sameVnode</span><span class="token punctuation">(</span><span class="token parameter">oldVnode<span class="token punctuation">,</span> vnode</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">//两节点key值相同，并且sel属性值相同，即认为两节点属同一类型，可进行下一步比较</span>
    <span class="token keyword">return</span> vnode<span class="token punctuation">.</span>key <span class="token operator">===</span> oldVnode<span class="token punctuation">.</span>key <span class="token operator">&amp;&amp;</span> vnode<span class="token punctuation">.</span>sel <span class="token operator">===</span> oldVnode<span class="token punctuation">.</span>sel
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>也就是说，即便同一个节点，只是className不同，Vue也会认为是两个不同类型的节点，从而<strong>直接用新节点替换整个老节点</strong>。</p> <blockquote><p>这和React Diff实现不同，react对于同一节点元素认为是同一类型节点，只更新其节点上的属性。</p></blockquote> <h3 id="patchvnode"><a href="#patchvnode" class="header-anchor">#</a> patchVnode</h3> <p>两个节点值得比较时，会调用<code>patchVnode</code></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">patchVnode</span> <span class="token punctuation">(</span><span class="token parameter">oldVnode<span class="token punctuation">,</span> vnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 作用：让vnode.el引用到现在真实dom（即oldVnode.el）；同时当el发生变化时，vnode.el会同时变化</span>
    <span class="token keyword">const</span> el <span class="token operator">=</span> vnode<span class="token punctuation">.</span>el <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>el
    <span class="token keyword">let</span> i<span class="token punctuation">,</span> oldCh <span class="token operator">=</span> oldVnode<span class="token punctuation">.</span>children<span class="token punctuation">,</span> ch <span class="token operator">=</span> vnode<span class="token punctuation">.</span>children
    <span class="token comment">// 情况一：引用一致，没有变化</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldVnode <span class="token operator">===</span> vnode<span class="token punctuation">)</span> <span class="token keyword">return</span>
    <span class="token comment">// 情况二：仅为文本节点发生变化，直接修改</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>oldVnode<span class="token punctuation">.</span>text <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> vnode<span class="token punctuation">.</span>text <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> oldVnode<span class="token punctuation">.</span>text <span class="token operator">!==</span> vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        api<span class="token punctuation">.</span><span class="token function">setTextContent</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> vnode<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">updateEle</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> oldVnode<span class="token punctuation">)</span>
        <span class="token comment">// 情况三：新、旧节点都有子节点，且不一样，调用updateChildren比较（Vue diff核心）</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>oldCh <span class="token operator">&amp;&amp;</span> ch <span class="token operator">&amp;&amp;</span> oldCh <span class="token operator">!==</span> ch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">updateChildren</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> ch<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 情况四：只有新节点具有子节点，因为vnode.el引用了老的dom节点，createEle会在老dom上添加子节点</span>
            <span class="token function">createEle</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span> <span class="token comment">//create el's children dom</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>oldCh<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 情况五：新节点没有子节点，老节点有子节点，直接删除老节点</span>
            api<span class="token punctuation">.</span><span class="token function">removeChildren</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="updatechildren"><a href="#updatechildren" class="header-anchor">#</a> updateChildren</h3> <p>当两个节点值得比较，且它们都有子节点，且不一样时，调用<code>updateChildren</code>。</p> <p><strong>步骤</strong>：</p> <ul><li><code>oldCh</code>和<code>newCh</code>各有两个头尾的变量<code>StartIdx</code>和<code>EndIdx</code></li> <li>依次进行4次比较：<strong>旧头新头、旧尾新尾、旧头新尾、旧尾新头</strong> 它们是否为同一类型节点。若是，则 <strong>“这一对值得比较”</strong>，开始<code>patchVnode</code></li> <li>若4次匹配不上，开始比较<code>key</code>值</li> <li>会从 用<code>key</code>值生成的对象<code>oldKeyToIdx</code> 中查找匹配节点</li> <li>最后变量会往中间靠拢，当<code>StartIdx</code>&gt;<code>EndIdx</code>时结束比较。</li></ul> <p><img src="/assets/img/img-7.66473de8.png" alt="alt"></p> <p><strong>总结遍历过程，有3种DOM操作</strong>：</p> <ul><li>当<code>oldStartVnode</code>、<code>newEndVnode</code>值得比较，说明<code>oldStartVnode.el</code>需要移动到<code>oldEndVnode.el</code>后边</li> <li>当<code>oldEndVnode</code>、<code>newStartVnode</code>值得比较，说明<code>oldEndVnode.el</code>需要移动到<code>oldStartVnode.el</code>前边</li> <li>当<code>newCh</code>的节点<code>oldCh</code>没有，将新节点插入到<code>oldStartVnode.el</code>前边</li></ul> <p><strong>结束时，分2种情况</strong>：</p> <ul><li><code>oldStartIdx &gt; oldEndIdx</code>，表示<code>oldCh</code>先遍历完，此时<code>newStartIdx</code>和<code>newEndIdx</code>之间的vnode是新增的，调用<code>addVnodes</code>。新节点被插入到子节点的末尾</li> <li><code>newStartIdx &gt; newEndIdx</code>，表示<code>newCh</code>先遍历完，此时<code>oldStartIdx</code>和<code>oldEndIdx</code>之间的vnode在新的节点里已经不存在了，调用<code>removeVnodes</code>将它们从DOM里删除。</li></ul> <h3 id="总结vue-diff流程"><a href="#总结vue-diff流程" class="header-anchor">#</a> 总结Vue Diff流程</h3> <p><img src="/assets/img/img-13.f4b785d9.png" alt="alt"></p> <h4 id="demo"><a href="#demo" class="header-anchor">#</a> Demo</h4> <p>假设现在有个父节点<code>&lt;div class=&quot;parent&quot;&gt;&lt;/div&gt;</code>，下面有<code>a、b、c、d</code>这四个不同的子节点。突然发生一次<code>patch</code>，改变了子节点的内容。</p> <h3 id="没有设置key"><a href="#没有设置key" class="header-anchor">#</a> 没有设置key</h3> <ul><li>执行<code>patch</code></li> <li>先从父节点开始，比较其<code>oldVnode</code>、<code>newVnode</code>，发现<strong>值得比较</strong>。</li> <li>传入父节点的新、旧Vnode节点，执行<code>patchVnode</code></li> <li>先是将真实dom（<code>oldVnode.el</code>）赋值给<code>vnode.el</code>、<code>el</code>。作用是当el发生变化，<code>vnode.el</code>会同时变化</li> <li>判断情况一：引用不一致，发生了变化</li> <li>判断情况二：不为文本节点，继续判断</li> <li>判断情况三：新、旧子节点都有各自且不同的子节点，调用<code>updateChildren</code>比较（Vue diff核心，即头尾的4次比较）</li> <li>对于<code>b</code>节点：
<ul><li>依次比较<code>旧头新头</code>、<code>旧尾新尾</code>、<code>旧头新尾</code>、<code>旧尾新头</code>，发现都不值得比较；</li> <li>开始比较<code>key</code></li> <li>发现<code>key</code>值不存在，执行<code>insertBefore</code>，将<code>新头</code>插入到<code>旧头</code>前面</li> <li><code>newStartIdx++</code>，新头下标继续往后。为<code>e</code>节点</li></ul></li> <li>对于<code>e</code>节点：
<ul><li>依次比较<code>旧头新头</code>、<code>旧尾新尾</code>、<code>旧头新尾</code>、<code>旧尾新头</code>，发现都不值得比较；</li> <li>开始比较<code>key</code></li> <li>发现<code>key</code>值不存在，执行<code>insertBefore</code>，将<code>新头</code>插入到<code>旧头</code>前面</li> <li><code>newStartIdx++</code>，新头下标继续往后。为<code>d</code>节点</li></ul></li> <li>对于<code>d</code>节点：
<ul><li>发现<code>旧尾新头</code>为同一类型节点，<strong>值得比较</strong>；</li> <li>开始执行<code>patchVnode</code>，发现引用一致没有变化，将<code>旧尾</code>插入到<code>新头</code>前面</li> <li><code>newStartIdx++</code>、<code>oldEndIdx--</code>，新头下标继续往后、旧尾下标往前。此时新头为<code>c</code>，旧尾为<code>c</code></li></ul></li> <li>对于<code>c</code>节点：
<ul><li>发现<code>旧尾新头</code>为同一类型节点，<strong>值得比较</strong>；</li> <li>开始执行<code>patchVnode</code>，发现引用一致没有变化，将<code>旧尾</code>插入到<code>新头</code>前面</li> <li><code>newStartIdx++</code>、<code>oldEndIdx--</code>，新头下标继续往后、旧尾下标往前。</li> <li>此时<code>newStartIdx &gt; newEndIdx</code>，表示<code>newCh</code>先遍历完，此时<code>oldStartIdx</code>、<code>oldEndIdx</code>之间的节点<code>a</code>、<code>b</code>已经不存在了，调用<code>removeVnodes</code>将它们从DOM里删除</li></ul></li></ul> <p><img src="/assets/img/img-8.810efedd.png" alt="alt"></p> <h3 id="设置了key"><a href="#设置了key" class="header-anchor">#</a> 设置了key</h3> <blockquote><p>若设置了key值，b元素将得到复用。</p></blockquote> <ul><li>执行<code>patch</code></li> <li>先从父节点开始，比较其<code>oldVnode</code>、<code>newVnode</code>，发现<strong>值得比较</strong>。</li> <li>传入父节点的新、旧Vnode节点，执行<code>patchVnode</code></li> <li>先是将真实dom（<code>oldVnode.el</code>）赋值给<code>vnode.el</code>、<code>el</code>。作用是当el发生变化，<code>vnode.el</code>会同时变化</li> <li>判断情况一：引用不一致，发生了变化</li> <li>判断情况二：不为文本节点，继续判断</li> <li>判断情况三：新、旧子节点都有各自且不同的子节点，调用<code>updateChildren</code>比较（Vue diff核心，即头尾的4次比较）</li> <li>对于<code>b</code>节点：
<ul><li>依次比较<code>旧头新头</code>、<code>旧尾新尾</code>、<code>旧头新尾</code>、<code>旧尾新头</code>，发现都不值得比较；</li> <li><strong>开始比较<code>key</code></strong>（<code>key</code>值设置与否，不同在于这一步！！）</li> <li>发现<code>key</code>值在旧集合中，存在一个同<code>key</code>的下标，将旧集合中的该元素设为<code>elmToMove</code></li> <li>判断<code>elmToMove</code>和<code>新头</code>节点的选择器<code>sel</code>（因为<code>key</code>已经为相同）</li> <li>发现<code>sel</code>相同，表明他们<strong>值得比较</strong></li> <li>将旧集合对应节点设为<code>null</code>，并将<code>elmToMove</code>节点插入到<code>旧头</code>前</li> <li><code>newStartIdx++</code>，新头下标继续往后。为<code>e</code>节点</li></ul></li> <li>对于<code>e</code>节点：
<ul><li>依次比较<code>旧头新头</code>、<code>旧尾新尾</code>、<code>旧头新尾</code>、<code>旧尾新头</code>，发现都不值得比较；</li> <li>开始比较<code>key</code></li> <li>发现<code>key</code>值在旧集合中不存在，直接将<code>新头</code>插入到<code>旧头</code>前</li> <li><code>newStartIdx++</code>，新头下标继续往后。为<code>d</code>节点</li></ul></li> <li>对于<code>d</code>节点：
<ul><li>发现<code>旧尾新头</code>为同一类型节点，<strong>值得比较</strong>；</li> <li>开始执行<code>patchVnode</code>，发现引用一致没有变化，将<code>旧尾</code>插入到<code>新头</code>前面</li> <li><code>newStartIdx++</code>、<code>oldEndIdx--</code>，新头下标继续往后、旧尾下标往前。此时新头为<code>c</code>，旧尾为<code>c</code></li></ul></li> <li>对于<code>c</code>节点：
<ul><li>发现<code>旧尾新头</code>为同一类型节点，<strong>值得比较</strong>；</li> <li>开始执行<code>patchVnode</code>，发现引用一致没有变化，将<code>旧尾</code>插入到<code>新头</code>前面</li> <li><code>newStartIdx++</code>、<code>oldEndIdx--</code></li> <li>此时<code>newStartIdx &gt; newEndIdx</code>，表示<code>newCh</code>先遍历完，此时<code>oldStartIdx</code>、<code>oldEndIdx</code>之间的节点<code>a</code>、<code>b</code>已经不存在了，调用<code>removeVnodes</code>将它们从DOM里删除</li></ul></li></ul> <p><img src="/assets/img/img-9.b0e0ec3d.png" alt="alt"></p> <h3 id="vue-updatechildren源码"><a href="#vue-updatechildren源码" class="header-anchor">#</a> vue updateChildren源码</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">updateChildren</span> <span class="token punctuation">(</span><span class="token parameter">parentElm<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> newCh</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> oldStartIdx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> newStartIdx <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">let</span> oldEndIdx <span class="token operator">=</span> oldCh<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>
    <span class="token keyword">let</span> oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">let</span> oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span>oldEndIdx<span class="token punctuation">]</span>
    <span class="token keyword">let</span> newEndIdx <span class="token operator">=</span> newCh<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>
    <span class="token keyword">let</span> newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">let</span> newEndVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span>newEndIdx<span class="token punctuation">]</span>
    <span class="token keyword">let</span> oldKeyToIdx
    <span class="token keyword">let</span> idxInOld
    <span class="token keyword">let</span> elmToMove
    <span class="token keyword">let</span> before
    <span class="token keyword">while</span> <span class="token punctuation">(</span>oldStartIdx <span class="token operator">&lt;=</span> oldEndIdx <span class="token operator">&amp;&amp;</span> newStartIdx <span class="token operator">&lt;=</span> newEndIdx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>oldStartVnode <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token comment">//对于vnode.key的比较，会把oldVnode = null</span>
                oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">++</span>oldStartIdx<span class="token punctuation">]</span> 
            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>oldEndVnode <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">--</span>oldEndIdx<span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>newStartVnode <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIdx<span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>newEndVnode <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                newEndVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">--</span>newEndIdx<span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">)</span>
                oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">++</span>oldStartIdx<span class="token punctuation">]</span>
                newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIdx<span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">)</span>
                oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">--</span>oldEndIdx<span class="token punctuation">]</span>
                newEndVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">--</span>newEndIdx<span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldStartVnode<span class="token punctuation">,</span> newEndVnode<span class="token punctuation">)</span>
                api<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> oldStartVnode<span class="token punctuation">.</span>el<span class="token punctuation">,</span> api<span class="token punctuation">.</span><span class="token function">nextSibling</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">.</span>el<span class="token punctuation">)</span><span class="token punctuation">)</span>
                oldStartVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">++</span>oldStartIdx<span class="token punctuation">]</span>
                newEndVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">--</span>newEndIdx<span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sameVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">patchVnode</span><span class="token punctuation">(</span>oldEndVnode<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">)</span>
                api<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> oldEndVnode<span class="token punctuation">.</span>el<span class="token punctuation">,</span> oldStartVnode<span class="token punctuation">.</span>el<span class="token punctuation">)</span>
                oldEndVnode <span class="token operator">=</span> oldCh<span class="token punctuation">[</span><span class="token operator">--</span>oldEndIdx<span class="token punctuation">]</span>
                newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIdx<span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
               <span class="token comment">// 使用key时的比较</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>oldKeyToIdx <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    oldKeyToIdx <span class="token operator">=</span> <span class="token function">createKeyToOldIdx</span><span class="token punctuation">(</span>oldCh<span class="token punctuation">,</span> oldStartIdx<span class="token punctuation">,</span> oldEndIdx<span class="token punctuation">)</span> <span class="token comment">// 有key生成index表</span>
                <span class="token punctuation">}</span>
                idxInOld <span class="token operator">=</span> oldKeyToIdx<span class="token punctuation">[</span>newStartVnode<span class="token punctuation">.</span>key<span class="token punctuation">]</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>idxInOld<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    api<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> <span class="token function">createEle</span><span class="token punctuation">(</span>newStartVnode<span class="token punctuation">)</span><span class="token punctuation">.</span>el<span class="token punctuation">,</span> oldStartVnode<span class="token punctuation">.</span>el<span class="token punctuation">)</span>
                    newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIdx<span class="token punctuation">]</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    elmToMove <span class="token operator">=</span> oldCh<span class="token punctuation">[</span>idxInOld<span class="token punctuation">]</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>elmToMove<span class="token punctuation">.</span>sel <span class="token operator">!==</span> newStartVnode<span class="token punctuation">.</span>sel<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        api<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> <span class="token function">createEle</span><span class="token punctuation">(</span>newStartVnode<span class="token punctuation">)</span><span class="token punctuation">.</span>el<span class="token punctuation">,</span> oldStartVnode<span class="token punctuation">.</span>el<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
                        <span class="token function">patchVnode</span><span class="token punctuation">(</span>elmToMove<span class="token punctuation">,</span> newStartVnode<span class="token punctuation">)</span>
                        oldCh<span class="token punctuation">[</span>idxInOld<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span>
                        api<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> elmToMove<span class="token punctuation">.</span>el<span class="token punctuation">,</span> oldStartVnode<span class="token punctuation">.</span>el<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                    newStartVnode <span class="token operator">=</span> newCh<span class="token punctuation">[</span><span class="token operator">++</span>newStartIdx<span class="token punctuation">]</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>oldStartIdx <span class="token operator">&gt;</span> oldEndIdx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            before <span class="token operator">=</span> newCh<span class="token punctuation">[</span>newEndIdx <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> newCh<span class="token punctuation">[</span>newEndIdx <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>el
            <span class="token function">addVnodes</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> before<span class="token punctuation">,</span> newCh<span class="token punctuation">,</span> newStartIdx<span class="token punctuation">,</span> newEndIdx<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>newStartIdx <span class="token operator">&gt;</span> newEndIdx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">removeVnodes</span><span class="token punctuation">(</span>parentElm<span class="token punctuation">,</span> oldCh<span class="token punctuation">,</span> oldStartIdx<span class="token punctuation">,</span> oldEndIdx<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br></div></div><h2 id="四种diff算法总结"><a href="#四种diff算法总结" class="header-anchor">#</a> 四种Diff算法总结</h2> <ul><li><p><strong>传统Diff</strong>：</p> <ul><li>通过<strong>递归</strong>，对 HTML DOM树里的节点 进行依次对比。</li></ul></li> <li><p><strong>React Virtual DOM Diff</strong>：</p> <ul><li>基于三个策略 <strong>（不同层级不比、不同组件类型不比、不同key值不比）</strong> <ul><li>忽略DOM节点的跨层级操作（因为特别少）</li> <li>同一类型的两个组件会生成相似的树形结构，不同类型的两个组件会生成不同的树形结构</li> <li>同一层级的子节点，通过<code>key</code>值进行区分</li></ul></li> <li>根据不同细粒度（tree、component、element）进行Diff
<ul><li>tree diff：对树进行 <strong>同层比较</strong>。
<ul><li>【做法：如果节点不存在则会直接销毁，不会进一步比较】</li></ul></li> <li>component diff：根据组件 <strong>“是否为同一类型”</strong>，采取不同做法。
<ul><li>【做法：同一类型的组件：按照 <code>同层比较策略</code> 继续比较（也可通过<code>shouldComponentUpdate()</code>来判断是否需要diff）；若为不同类型的组件，则替换整个组件】</li></ul></li> <li>element diff：根据新节点的<code>key</code>值以及<code>在旧集合位置</code>，采取不同做法。
<ul><li>【做法：遍历新集合中的节点；通过<code>key</code>判断 <code>“旧集合中是否存在相同节点”</code>，若不存在，则插入；否则，比较 <code>当前节点在旧集合中的位置</code> 与 <code>访问过的节点，在旧集合中最右的位置</code>：若当前节点在旧集合中的位置靠后，则不需移动；否则移动。】</li></ul></li></ul></li></ul></li> <li><p><strong>Fiber Diff</strong>：</p> <ul><li>从链表头开始遍历，碰到一个节点就和它自己的 <code>alternate</code> 比较，并记录下需要更新的东西（作为<code>commit</code>），并把这些更新通过 <code>return</code> 提交到当前节点的父节点。当遍历完整个链表时，再通过 <code>return</code> 回溯到根节点。这样就能把所有的更新全部带到根节点，最后更新到真实的DOM中。</li></ul></li> <li><p><strong>Vue Virtual DOM Diff</strong>：</p> <ul><li>Vue只作 <strong>同层比较</strong>，且对于 <strong>不同类型的节点</strong> 会直接用新节点替换</li> <li>先让<code>vnode.el</code>引用真实dom（为了同步变化）后，开始比较<code>oldVnode</code>、<code>vnode</code></li> <li>依次判断 <strong>5类情况</strong>：
<ul><li>1、引用是否一致；【做法：不需改变】</li> <li>2、新旧都为文本节点【做法：只需修改text】</li> <li>3、新旧节点都有子节点，而且它们不一样【做法：执行<code>updateChildren</code>】<strong>（Vue Diff核心）</strong>；</li> <li>4、只有新节点有子节点；【做法：在老节点上添加新节点】</li> <li>5、只有旧节点有子节点，新节点没有子节点。【做法：直接删除老节点】</li></ul></li> <li>在<code>updateChildren</code>的过程中，<code>oldCh</code>、<code>newCh</code>会进行 <strong>头尾两端的相互比较</strong> （即：旧头新头、旧尾新尾、旧头新尾、旧尾新头）。若设置<code>key</code>，会多了一步“查找匹配节点”</li> <li>最后指针会往中间靠拢，直到结束</li></ul></li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <ul><li><p>对于“同一类型”这个说法，React会认为“两节点是同一个组件类的不同实例、相同HTML标签”这类”是属于同一类型；Vue会认为“两节点的key &amp;&amp; sel相同”时是属于同一类型。</p></li> <li><p>另外，vue中在使用相同标签名元素的 <strong>过渡切换</strong> 时，<strong>需用不同key值作区分</strong>。否则vue只会替换其内部属性而不会触发过渡效果。</p></li></ul></div> <h2 id="参考链接"><a href="#参考链接" class="header-anchor">#</a> 参考链接</h2> <ul><li><a href="https://zhuanlan.zhihu.com/p/20346379" target="_blank" rel="noopener noreferrer">React 源码剖析系列 － 不可思议的 react diff<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://cloud.tencent.com/developer/article/1402610" target="_blank" rel="noopener noreferrer">谈谈React中Diff算法的策略及实现<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.ptbird.cn/react-diff-from-code.html" target="_blank" rel="noopener noreferrer">React diff 策略<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://cloud.tencent.com/developer/article/1477707" target="_blank" rel="noopener noreferrer">详解 React 16 的 Diff 策略<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://segmentfault.com/a/1190000018488975" target="_blank" rel="noopener noreferrer">React16性能改善的原理（二）<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">4/27/2020, 11:17:11 PM</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/skill/web/cdn/">
        CDN
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.65a89ca6.js" defer></script><script src="/assets/js/2.f29da71a.js" defer></script><script src="/assets/js/3.db4d2d0b.js" defer></script>
  </body>
</html>
